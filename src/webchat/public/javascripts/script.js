var __t;__t=function(ns){var curr,index,part,parts,_i,_len;curr=null,parts=[].concat=ns.split(".");for(index=_i=0,_len=parts.length;_i<_len;index=++_i){part=parts[index];if(curr===null){curr=eval(part);continue}curr[part]==null?curr=curr[part]={}:curr=curr[part]}return curr};var services={},messages={},controllers={},filters={};((function(){var a,b,c,d,e=this,f={}.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},h=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};c=angular.module("WebChat",[]).config(function(a){a.value("WEBSOCKET_DOMAIN",document.location.host),a.value("WEBSOCKET_PATH","/websocket"),a.value("WEBSOCKET_SSL",!1)}),c.run(function(a){}),angular.module("WebChat").factory("activechannel",["$rootScope",function(a){var b;return b={},b.activeChannelId=null,b.setActiveChannelId=function(b){return this.activeChannelId=b,a.$broadcast("changed_channel")},b.getActiveChannelId=function(){return this.activeChannelId},b}]),__t("services").WebChatWebSocket=function(){function a(){this._callbacks={onOpen:function(){return console.info("websocket is open")},onReceive:function(){},onError:function(){return console.error("websocket error occured")},onClose:function(){return console.info("closed websocket")}}}return a.prototype.connect=function(a,b,c){var d,e,f,g=this;a==null&&(a=document.location.host),b==null&&(b="/websocket"),this.ssl=c!=null?c:!1,d=window.MozWebSocket||window.WebSocket,this.ssl?e="wss://":e="ws://",f=""+e+a+b;try{return this._connection=new d(f),this._connection.onopen=function(){return g._callbacks.onOpen(),window.onbeforeunload=function(){return g.close()}},this._connection.onmessage=function(a){var b,c;c=a.data,b=JSON.parse(c),g._callbacks.onReceive(b),console.info("Received: "+c);if(b.type==="status"&&b.data.level!=="ok")return console.warn(b.data.msg)},this._connection.onclose=function(){return g._callbacks.onClose()},this._connection.onerror=function(){return g._callbacks.onError()}}catch(h){return console.error("Cant connect to "+f)}},a.prototype.onOpen=function(a){return this._callbacks.onOpen=a},a.prototype.onReceive=function(a){return this._callbacks.onReceive=a},a.prototype.onClose=function(a){return this._callbacks.onClose=a},a.prototype.onError=function(a){return this._callbacks.onError=a},a.prototype.send=function(a){return this._connection.send(a),console.info("Sending "+a)},a.prototype.sendJSON=function(a){var b;return b=JSON.stringify(a),this.send(b)},a}(),angular.module("WebChat").factory("websocket",["$rootScope","WEBSOCKET_DOMAIN","WEBSOCKET_PATH","WEBSOCKET_SSL",function(a,b,c,d){var e;return e=new WebChatWebSocket,e.connect(b,c,d),e.onReceive(function(b){return a.$broadcast("message",b)}),e}]),b=require("webchat.Model"),__t("services").ChannelModel=function(a){function b(){b.__super__.constructor.call(this,"channel"),this.create({id:1,name:"channel",groups:[0],users:[0,1]})}return g(b,a),b}(b),angular.module("WebChat").factory("channelmodel",function(){var a;return a=new ChannelModel,a}),d=require("webchat"),d.Model=function(){function a(a){this.type=a,this.items=[]}return a.prototype.handle=function(a){switch(a.action){case"update":return this.update(a.data);case"create":return this.create(a.data);case"delete":return this["delete"](a.data)}},a.prototype.create=function(a){return this.items.push(a)},a.prototype.update=function(a){var b,c,d,e,f,g;f=this.items,g=[];for(b=d=0,e=f.length;d<e;b=++d)c=f[b],c.id===a.id?g.push(this.items[b]=a):g.push(void 0);return g},a.prototype["delete"]=function(a){var b,c,d,e,f,g;d=-1,g=this.items;for(b=e=0,f=g.length;e<f;b=++e)c=g[b],c.id===a.id&&(d=b);if(d>=0)return this.items.splice(d,1)},a.prototype.getItemById=function(a){var b,c,d,e;e=this.items;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.id===a)return b}},a.prototype.canHandle=function(a){return type===this.type?!0:!1},a}(),a=require("webchat.Message"),__t("messages").InviteUserMessage=function(a){function b(a,c,d){this.userId=a,this.channelId=c,this.value=d,b.__super__.constructor.call(this,"inviteuser")}return g(b,a),b.prototype.serialize=function(){var a;return a={channel_id:this.channelId,user_id:this.userId,value:this.value},b.__super__.serialize.call(this,a)},b}(a),d.InviteUserMessage=InviteUserMessage,a=require("webchat.Message"),__t("messages").PingMessage=function(a){function b(){b.__super__.constructor.call(this,"ping")}return g(b,a),b.prototype.serialize=function(){var a;return a={},b.__super__.serialize.call(this,a)},b}(a),d.PingMessage=PingMessage,a=require("webchat.Message"),__t("messages").ModUserMessage=function(a){function b(a,c,d){this.userId=a,this.channelId=c,this.value=d,b.__super__.constructor.call(this,"moduser")}return g(b,a),b.prototype.serialize=function(){var a;return a={channel_id:this.channelId,user_id:this.userId,value:this.value},b.__super__.serialize.call(this,a)},b}(a),d.ModUserMessage=ModUserMessage,a=require("webchat.Message"),__t("messages").ReadonlyUserMessage=function(a){function b(a,c,d){this.userId=a,this.channelId=c,this.value=d,b.__super__.constructor.call(this,"readonlyuser")}return g(b,a),b.prototype.serialize=function(){var a;return a={channel_id:this.channelId,user_id:this.userId,value:this.value},b.__super__.serialize.call(this,a)},b}(a),d.ReadonlyUserMessage=ReadonlyUserMessage,d=require("webchat"),d.Message=function(){function a(a){this.type=a}return a.prototype.serialize=function(a){var b;return b={type:this.type,data:a},b},a}(),a=require("webchat.Message"),__t("messages").InviteGroupMessage=function(a){function b(a,c,d){this.groupId=a,this.channelId=c,this.value=d,b.__super__.constructor.call(this,"invitegroup")}return g(b,a),b.prototype.serialize=function(){var a;return a={channel_id:this.channelId,group_id:this.groupId,value:this.value},b.__super__.serialize.call(this,a)},b}(a),d.InviteGroupMessage=InviteGroupMessage,a=require("webchat.Message"),__t("messages").JoinMessage=function(a){function b(a){this.id=a,b.__super__.constructor.call(this,"join")}return g(b,a),b.prototype.serialize=function(){var a;return a={id:this.id},b.__super__.serialize.call(this,a)},b}(a),d.JoinMessage=JoinMessage,a=require("webchat.Message"),__t("messages").ReadonlyGroupMessage=function(a){function b(a,c,d){this.groupId=a,this.channelId=c,this.value=d,b.__super__.constructor.call(this,"readonlygroup")}return g(b,a),b.prototype.serialize=function(){var a;return a={channel_id:this.channelId,user_id:this.groupId,value:this.value},b.__super__.serialize.call(this,a)},b}(a),d.ReadonlyGroupMessage=ReadonlyGroupMessage,a=require("webchat.Message"),__t("messages").ModGroupMessage=function(a){function b(a,c,d){this.groupId=a,this.channelId=c,this.value=d,b.__super__.constructor.call(this,"modgroup")}return g(b,a),b.prototype.serialize=function(){var a;return a={channel_id:this.channelId,user_id:this.groupId,value:this.value},b.__super__.serialize.call(this,a)},b}(a),d.ModGroupMessage=ModGroupMessage,a=require("webchat.Message"),__t("messages").SendMessage=function(a){function b(a,c,d){this.text=a,this.type=c,this.channelId=d,b.__super__.constructor.call(this,"message")}return g(b,a),b.prototype.serialize=function(){var a;return a={message:this.text,type:this.type,channel_id:this.channelId},b.__super__.serialize.call(this,a)},b}(a),d.SendMessage=SendMessage,$(document).ready(function(){return $("#input_field").focus()}),__t("controllers").ChannelController=function(){function a(a,b,c){var d=this;this.websocket=b,this.activechannel=c,this.activeChannelId=null,this.getActiveChannelId=function(){return d.activechannel.getActiveChannelId()},this.setActiveChannelId=function(a){return d.activechannel.setActiveChannelId(a)},this.simpleChannelMessage=function(a,b,c){var e,f;e=d.getActiveChannelId();if(e!==null)return f=new b(a,e,c),d.websocket.sendJSON(f.serialize())},a.getActiveChannelId=function(){return d.getActiveChannelId()},a.join=function(b){var c;return c=new WebChat.JoinMessage(b),d.websocket.sendJSON(c.serialize()),d.setActiveChannelId(b),a.selected=b},a.sendMessage=function(a,b){var c,e;c=d.getActiveChannelId();if(c!==null)return e=new WebChat.SendMessage(a,b,c),d.websocket.sendJSON(e.serialize())},a.inviteUser=function(a,b){return d.simpleChannelMessage(a,WebChat.InviteUserMessage,b)},a.inviteGroup=function(a,b){return d.simpleChannelMessage(a,WebChat.InviteGroupMessage,b)},a.modUser=function(a,b){return d.simpleChannelMessage(a,WebChat.ModUserMessage,b)},a.modGroup=function(a,b){return d.simpleChannelMessage(a,WebChat.ModGroupMessage,b)},a.readonlyUser=function(a,b){return d.simpleChannelMessage(a,WebChat.ReadonlyUserMessage,b)},a.readonlyGroup=function(a,b){return d.simpleChannelMessage(a,WebChat.ReadonlyGroupMessage,b)}}return a}(),angular.module("WebChat").controller("ChannelController",["$scope","websocket","activechannel",function(a,b,c){return new ChannelController(a,b,c)}]),__t("controllers").ChannelController=function(){function a(a,b,c,d){var e=this;this.websocket=b,this.activechannel=c,this.channelmodel=d,this.activeChannelId=null,this.getActiveChannelId=function(){return e.activechannel.getActiveChannelId()},this.setActiveChannelId=function(a){return e.activechannel.setActiveChannelId(a)},this.simpleChannelMessage=function(a,b,c){var d,f;d=e.getActiveChannelId();if(d!==null)return f=new b(a,d,c),e.websocket.sendJSON(f.serialize())},a.getActiveChannelId=function(){return e.getActiveChannelId()},a.join=function(b){var c;return c=new WebChat.JoinMessage(b),e.websocket.sendJSON(c.serialize()),e.setActiveChannelId(b),a.selected=b},a.sendMessage=function(a,b){var c,d;c=e.getActiveChannelId();if(c!==null)return d=new WebChat.SendMessage(a,b,c),e.websocket.sendJSON(d.serialize())},a.inviteUser=function(a,b){return e.simpleChannelMessage(a,WebChat.InviteUserMessage,b)},a.inviteGroup=function(a,b){return e.simpleChannelMessage(a,WebChat.InviteGroupMessage,b)},a.modUser=function(a,b){return e.simpleChannelMessage(a,WebChat.ModUserMessage,b)},a.modGroup=function(a,b){return e.simpleChannelMessage(a,WebChat.ModGroupMessage,b)},a.readonlyUser=function(a,b){return e.simpleChannelMessage(a,WebChat.ReadonlyUserMessage,b)},a.readonlyGroup=function(a,b){return e.simpleChannelMessage(a,WebChat.ReadonlyGroupMessage,b)}}return a}(),angular.module("WebChat").controller("ChannelController",["$scope","websocket","activechannel","channelmodel",function(a,b,c,d){return new ChannelController(a,b,c,d)}]),angular.module("WebChat").filter("userInChannel",function(){return function(a,b){var c,d,e,f,g;c=[];for(e=0,f=a.length;e<f;e++)d=a[e],(g=d.id,h.call(b.users,g)>=0)&&c.push(d);return c}}),angular.module("WebChat").filter("groupInChannel",function(){return function(a,b){var c,d,e,f,g;d=[];for(e=0,f=a.length;e<f;e++)c=a[e],(g=c.id,h.call(b.groups,g)>=0)&&d.push(c);return d}}),angular.module("WebChat").filter("userInGroup",function(){return function(a,b){var c,d,e,f,g,h,i,j;d=[];for(f=0,h=a.length;f<h;f++){e=a[f],j=e.groups;for(g=0,i=j.length;g<i;g++)c=j[g],b.groupid===c&&d.push(e)}return d}})})).call(this)